{% extends 'QuarryIQ/base.html' %}

{% block content %}
<title>Quarry IQ - Project Portal</title>

<h2>Quarry IQ - Project Portal</h2>
<h4>Project: {{ project_company }} {{ project_name }} {{ project_time_period }}</h4>

<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>

<div class="table-container" style="max-width: 700px;">
    <table class="table">
        <thead>
            <tr>
                <th>Feature</th>
                <th>Completion</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="height: 60px;">
                    {% if is_editor %}
                    <form id="productCleaningForm" action="{% url 'Product_Cleaning' project_data.project_id %}" method="get" {% if not modified_transactions_df_empty %} onsubmit="return confirmProductCleaning()" {% endif %}>
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">Product Cleaning</button>
                    </form>
                    {% endif %}
                </td>

                {% if not modified_transactions_df_empty %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr>
                <td>
                    <form onsubmit="return checkAndRedirect('{% url 'Heatmap_Portal' project_data.project_id %}')" method="get">
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">Heat maps</button>
                    </form>
                </td>
                {% if not modified_transactions_df_empty %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr>
                <td>
                    <form onsubmit="return checkAndRedirect('{% url 'Streamsmap_Portal' project_data.project_id %}')" method="get">
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">Streams maps</button>
                    </form>
                </td>
                {% if not modified_transactions_df_empty %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr>
                <td>
                    <form onsubmit="return checkAndRedirect('{% url 'P4P_Portal' project_data.project_id %}')" method="get">
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">Production for Profit</button>
                    </form>
                </td>
                {% if not modified_transactions_df_empty %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: {{ P4P_completion }}%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr>
                <td>
                    <form onsubmit="return checkAndRedirect('{% url 'B4C_Portal' project_data.project_id %}')" method="get">
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">Balance for Cash</button>
                    </form>
                </td>
                {% if not modified_transactions_df_empty %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: {{ B4C_completion }}%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr>
                <td>
                    <form onsubmit="return checkAndRedirect('{% url 'FarSeer_Portal' project_data.project_id %}')" method="get">
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">FarSeer Forecast</button>
                    </form>
                </td>
                {% if not modified_transactions_df_empty %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: {{ FarSeer_completion }}%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr>
                <td>
                    <form onsubmit="return checkAndRedirect('{% url 'Network_Optimisation_Portal' project_data.project_id %}')" method="get">
                        <button style="width: 250px;" class='btn btn-outline-dark' type="submit">Network Optimisation</button>
                    </form>
                </td>
                {% if not modified_transactions_df_empty and NO_Baseline_Done %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 100%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% else %}
                <td style="vertical-align: middle;">
                    <div class="progress">
                      <div class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </td>
                {% endif %}
            </tr>
            <tr><td class="empty"></td></tr>
            <tr>
                <td class="empty">
                    <button id="backToPortal" class='btn btn-warning' style="width: 250px;">Go Back To Project List</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>




<script>

document.getElementById('backToPortal').addEventListener('click', function() {
    // Navigate to the URL
    window.location.href = "{% url 'Project_List' %}";
});


function checkAndRedirect(url) {
    if ("{{ modified_transactions_df_empty }}" === "True") {
        alert("Please complete 'Product Cleaning' before accessing other features.");
        return false; // Prevent form submission
    } else {
        // Redirect to the respective URL
        window.location.href = url;
        return false; // Prevent form submission
    }
}

function confirmProductCleaning() {
    return confirm("Performing 'Product Cleaning' will delete all P4P, B4C, FarSeer Forecast and Network Optimisation data. Do you want to continue?");
}
</script>

{% endblock content %}