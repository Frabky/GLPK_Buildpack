{% extends 'QuarryIQ/base.html' %}

{% block content %}

<title>FarSeer - Results Summary</title>

<h2>FarSeer Forecast - Results Summary</h2>
<h4>Project: {{ project_name }} {{ project_time_period }}</h4>
<h4>Quarry: {{ quarry_name }}</h4>


<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>



<div class="table-container" style="max-width: 1800px;">
    <table class="table">
        <thead>
            <tr>
                <td class="empty"></td>
                <th style="vertical-align: middle;" colspan="11">SUMMARY TABLE - ALL RESULTS - {{ starting_month|upper }} TO {{ final_month|upper }}</th>
            </tr>
            <tr>
                <td class="empty"></td>
                <th style="vertical-align: middle;" colspan="2">Forced Sales</th>
                <td class="empty"></td>
                <th style="vertical-align: middle;" colspan="2">Non Essential Sales</th>
                <td class="empty"></td>
                <th style="vertical-align: middle;" colspan="2">Stock Information</th>
                <td class="empty"></td>
                <th style="vertical-align: middle;" colspan="2">Profitability</th>
            </tr>
            <tr>
                <td class="empty"></td>
                <th style="vertical-align: middle;">Forecast Volume [t]</th>
                <th style="vertical-align: middle;">Sales Volume [t]</th>
                <td class="empty"></td>
                <th style="vertical-align: middle;">Forecast Volume [t]</th>
                <th style="vertical-align: middle;">Sales Volume [t]</th>
                <td class="empty"></td>
                <th style="vertical-align: middle;">Closing Stock [t]</th>
                <th style="vertical-align: middle;">Closing Stock [{{ currency }}]</th>
                <td class="empty"></td>
                <th style="vertical-align: middle;">Turnover [{{ currency }}]</th>
                <th style="vertical-align: middle;">Gross Margin [{{ currency }}]</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                {% if FarSeer_MeetAllSales_OptimisationSuccess %}

                <td class="empty" style="vertical-align: middle;">
                    <form action="{% url 'FarSeer_Results_Meet_All_Sales' project_id=project_id quarry_id=quarry.quarry_id %}" method="get">
                        <button class="btn btn-outline-success" style="width: 250px;" type="submit">Meeting All Sales</button>
                    </form>
                </td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Forecast_Forced }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Sales_Forced }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Forecast_NonEssential }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Sales_Non_Essential }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Closing_Stock }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Stock_Value }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Turnover }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetAllSales.Gross_Margin }}</td>

                {% else %}

                <td class="empty" style="vertical-align: middle;">
                    <button class="btn btn-outline-danger" style="width: 250px;" type="submit" id="MeetingAllSalesFailure">Meeting All Sales</button>
                </td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>

                {% endif %}
            </tr>


            <tr>
                {% if FarSeer_MeetForcedSales_OptimisationSuccess %}

                <td class="empty" style="vertical-align: middle;">
                    <form action="{% url 'FarSeer_Results_Meet_Forced_Sales' project_id=project_id quarry_id=quarry.quarry_id %}" method="get">
                        <button class="btn btn-outline-success" style="width: 250px;" type="submit">Meeting Forced Sales</button>
                    </form>
                </td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Forecast_Forced }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Sales_Forced }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Forecast_NonEssential }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Sales_Non_Essential }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Closing_Stock }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Stock_Value }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Turnover }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMeetForcedSales.Gross_Margin }}</td>

                {% else %}

                <td class="empty" style="vertical-align: middle;">
                    <button class="btn btn-outline-danger" style="width: 250px;" type="submit" id="MeetingForcedSalesFailure">Meeting Forced Sales</button>
                </td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>

                {% endif %}
            </tr>


            <tr>
                {% if FarSeer_MaxGM_OptimisationSuccess %}

                <td class="empty" style="vertical-align: middle;">
                    <form action="{% url 'FarSeer_Results_MaxGM' project_id=project_id quarry_id=quarry.quarry_id %}" method="get">
                        <button class="btn btn-outline-success" style="width: 250px;" type="submit">Maximizing Gross Margin</button>
                    </form>
                </td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Forecast_Forced }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Sales_Forced }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Forecast_NonEssential }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Sales_Non_Essential }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Closing_Stock }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Stock_Value }}</td>
                <td class="empty"></td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Turnover }}</td>
                <td style="vertical-align: middle;">{{ summaryTableMaxGM.Gross_Margin }}</td>

                {% else %}

                <td class="empty" style="vertical-align: middle;">
                    <button class="btn btn-outline-danger" style="width: 250px;" type="submit" id="MaxGMFailure">Maximizing Gross Margin</button>
                </td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>
                <td class="empty"></td>
                <td style="vertical-align: middle;"></td>
                <td style="vertical-align: middle;"></td>

                {% endif %}
            </tr>

            <tr><td class="empty"></td></tr>

            <tr>
                <td class="empty">
                    <button class='btn btn-warning' style="width: 250px;" id="backToPortal" onclick="redirectToPortal()">Go Back To FarSeer Portal</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>

<table><tr><th class="empty"></th><th class="empty"></th></tr></table>
<table><tr><th class="empty"></th><th class="empty"></th></tr></table>



    <input type="hidden" id="project_id" value="{{ project_id }}">
    <input type="hidden" id="quarry_id" value="{{ quarry_id }}">


<script>

    function redirectToPortal() {
        // Retrieve project_id and quarry_id values
        var project_id = document.getElementById("project_id").value;
        var quarry_id = document.getElementById("quarry_id").value;

        // Construct the URL
        var url = `/Existing_Projects/Data_Portal/FarSeer_Portal/${project_id}/`;

        // Navigate to the URL
        window.location.href = url;
    }

    document.getElementById('MeetingAllSalesFailure').addEventListener('click', function() {
        alert('No feasible solution.\nPlease check maximum opening hours for each month.');
    });

    document.getElementById('MeetingForcedSalesFailure').addEventListener('click', function() {
        alert('No feasible solution.\nPlease check maximum opening hours for each month.');
    });

    document.getElementById('MaxGMFailure').addEventListener('click', function() {
        alert('No feasible solution.\nPlease check maximum opening hours for each month.');
    });

</script>

{% endblock content %}